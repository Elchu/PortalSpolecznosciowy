@using Microsoft.AspNet.Identity
@using PortalSpolecznosciowy.Models
@using PortalSpolecznosciowy.Models.ViewModel
@model PortalSpolecznosciowy.Models.ViewModel.UserFriendToAcceptedViewModel

@{
    ViewBag.Title = "Informacje o użytkowniku";
}
<br />
<div class="row">
    <div class="col-md-3 col-md-offset-1">
        <div class="panel panel-default">
            <div class="panel-heading clearfix">
                <div class="pull-left">Użytkownik</div>
                <div class="pull-right">
                    @if (User.Identity.IsAuthenticated && User.Identity.GetUserId().Equals(Model.User.Id))
                    {
                        @Html.ActionLink("Edytuj", "Edit", "ProfilUser", new { id = Model.User.Id }, null)
                    }
                </div>
            </div>
            <div class="panel-body text-center">

                @if (!Model.User.Image.IsEmpty())
                {
                    <img src="@Url.Content("/Content/UploadUsersAvatars/" + Model.User.Id + "/" + Model.User.Image)" alt="Avatar użytkownika" height="200" width="200" />
                }

                <h2>
                    @if (User.Identity.IsAuthenticated && User.Identity.GetUserId().Equals(Model.User.Id))
                    {
                        @Html.ActionLink(Model.User.FullName, "Edit", "ProfilUser", new { id = Model.User.Id }, null)
                    }
                    else
                    {
                        @Model.User.FullName
                    }
                </h2>

                @if (Model.User.Sex == "m")
                {
                    <p>Mężczyzna</p>
                }
                else
                {
                    <p>Kobieta</p>
                }
                <p>@Model.User.Email</p>

                @if (User.Identity.IsAuthenticated && Model.User.Id == User.Identity.GetUserId())
                {
                    <p><a href="@Url.Action("ListOfFriends", "ProfilUser")" class="btn btn-xs btn-primary">Znajomych <span class="badge">@Model.AllFriendsUser.Count()</span></a></p>

                    <p>Użytkownicy do zaakceptowania: </p>
                    foreach (UserFriendTemp friend in Model.FriendsToAccepted)
                    {
                        if (friend.IsAccepted == false)
                        {
                            using (Html.BeginForm("Accept", "Friend", FormMethod.Post))
                            {
                                @Html.AntiForgeryToken()
                                @Html.Hidden("friendId", friend.IdUser)
                                <button class="btn btn-primary"><h6>Przyjmij zaproszenie od @friend.UserFullName</h6></button>
                            }
                        }

                    }
                }
            </div>
        </div>
    </div>

    <div class="col-md-7">
        <div class="panel panel-default">
            <div class="panel-body">
                @if (TempData["Message"] != null)
                {
                    <div class="alert alert-danger" role="alert">@TempData["Message"]</div>
                }

                @using (Html.BeginForm("AddPost", "Post", FormMethod.Post, htmlAttributes: new {id = "addPost"}))
                {
                    @Html.AntiForgeryToken()
                    @Html.Hidden("userId", Model.User.Id)
                    @Html.TextArea("Content", htmlAttributes: new { @class = "form-control", rows = 5, cols = 60, placeholder = "Co słychać?" })
                    @Html.ValidationMessage("Content", "", new { @class = "text-danger" })
                    <button type="submit" class="btn btn-default pull-right">Dodaj wpis</button>
                }
            </div>
        </div>

        @if (Model.User.Post.Count > 0)
        {
            foreach (Post post in Model.User.Post)
            {
                <div class="panel panel-default">
                    <div class="panel-body">
                        @if (User.Identity.IsAuthenticated && Model.User.Id == User.Identity.GetUserId())
                        {
                            <div class="dropdown pull-right">
                                <a href="" class="dropdown-toggle" data-toggle="dropdown">
                                    <span class="caret"></span>
                                </a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a href="@Url.Content("/ProfilUser/Edit/" + Model.User.Id)">Edytuj</a>
                                    </li>
                                    <li>
                                        <a href="@Url.Content("/ProfilUser/Delete/" + Model.User.Id)">Usuń</a>
                                    </li>
                                </ul>
                            </div>
                        } @*end if*@

                        <div class="clearfix">
                            <div class="media">
                                <div class="media-left media-middle">
                                    <a href="@Url.Content("/ProfilUser/Show/" + Model.User.Id)">
                                        <img src="@Url.Content("/Content/UploadUsersAvatars/" + Model.User.Id + "/" + Model.User.Image)" class="media-object img-responsive pull-left" style="margin-right: 10px;" alt="brak zdjęcia" height="64" width="64" />
                                    </a>
                                </div>
                                <div class="media-body">
                                    <p class="media-heading">
                                        @Html.ActionLink(Model.User.FullName, "Show", "ProfilUser", new { id = Model.User.Id }, null)
                                        Data dodania: <small><span class="glyphicon glyphicon-time"></span> @post.Date </small>
                                    </p>
                                    <div id="post_@post.PostId">
                                        @post.Content
                                    </div>
                                </div>
                            </div>
                        </div>@*clearfix*@
                    </div>@*panel-body*@
                </div>@*panel panel-default*@
            }/*end foreach*/
        }@*end if*@
    </div>
</div>


@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}